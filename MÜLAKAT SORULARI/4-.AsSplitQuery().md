
### ğŸ“Œ Ne iÅŸe yarar:

Bu, **bÃ¼yÃ¼k iliÅŸkili sorgularda performans optimizasyonu** saÄŸlar.

Normalde `.Include()` kullandÄ±ÄŸÄ±nda EF Core tek bir **JOIN sorgusu** Ã¼retir:

```sql
SELECT * FROM Hotels
LEFT JOIN Rooms ON Rooms.HotelId = Hotels.Id

```

Ama eÄŸer her otelin 1000 odasÄ± varsa, bu JOIN devasa bir sonuÃ§ seti oluÅŸturur.

AynÄ± otel bilgisi defalarca tekrarlanÄ±r (veri ÅŸiÅŸmesi olur).

`.AsSplitQuery()` dediÄŸinde EF Core ÅŸunu yapar:

> â€œJOIN yerine, her tabloyu ayrÄ± sorguda Ã§ek ve bellekte birleÅŸtir.â€

Yani ÅŸu hale getirir:

```sql
SELECT * FROM Hotels;
SELECT * FROM Rooms;

```

EF Core bu iki sonucu **RAMâ€™de iliÅŸkilendirir** ([Hotel.Id](http://Hotel.Id) â†” Room.HotelId).

---

### ğŸ’¡ FaydasÄ±:

- BÃ¼yÃ¼k veri kÃ¼melerinde **daha az bellek ÅŸiÅŸmesi**
- **Daha okunabilir** SQL sorgularÄ±
- **Performans artÄ±ÅŸÄ±** (Ã¶zellikle Ã§oklu `.Include()`â€™larda)

ğŸ§  Not:

- KÃ¼Ã§Ã¼k veri setlerinde fark azdÄ±r.
- Ã‡ok iliÅŸkili ve geniÅŸ verilerde fark Ã§ok bÃ¼yÃ¼ktÃ¼r.

## ğŸ¯ Ã–rnek Senaryo

Ä°ki tablo var:

- `Hotels` â†’ 2 kayÄ±t
- `Rooms` â†’ her otelde 2 oda

**Kod:**

```csharp
var hotels = await _db.Hotels
    .Include(h => h.Rooms)
    .ToListAsync();

```

ve sonra aynÄ± sorgunun `.AsSplitQuery()` versiyonu ğŸ‘‡

```csharp
var hotels = await _db.Hotels
    .Include(h => h.Rooms)
    .AsSplitQuery()
    .ToListAsync();

```

---

## ğŸ§© 1. `.AsSplitQuery()` **YOKKEN** (Default = Single Query Mode)

EF Core, tÃ¼m veriyi **tek bir bÃ¼yÃ¼k JOIN sorgusunda** Ã§eker.

ğŸ“œ **Ãœretilen SQL:**

```sql
SELECT h.Id, h.Name, h.City, h.Star,
       r.Id, r.Number, r.PricePerNight, r.HotelId
FROM Hotels AS h
LEFT JOIN Rooms AS r ON h.Id = r.HotelId;

```

ğŸ§  EF Core burada _tek sorgu_ atÄ±yor ama **JOIN sonucu ÅŸiÅŸiyor**.

ğŸ“Š **VeritabanÄ± sonucu (Ã¶rnek satÄ±rlar):**

|[h.Id](http://h.Id)|[h.Name](http://h.Name)|[r.Id](http://r.Id)|r.Number|HotelId|
|---|---|---|---|---|
|1|Hilton|1|101|1|
|1|Hilton|2|102|1|
|2|Sheraton|3|201|2|
|2|Sheraton|4|202|2|

Bak:

- â€œHiltonâ€ oteli 2 oda iÃ§in **iki kez tekrar ediyor.**
- â€œSheratonâ€ da aynÄ± ÅŸekilde.

EF Core bellekte bu tekrarlanan verileri **birleÅŸtirip** `Hotel` nesnesi altÄ±nda `Rooms`â€™a koyar,

ama o arada **veri ÅŸiÅŸmesi** olur (Ã¶rneÄŸin binlerce oda varsa devasa olur).

---

## ğŸ§© 2. `.AsSplitQuery()` **EKLENDÄ°ÄÄ°NDE**

EF Core artÄ±k â€œtek dev JOINâ€ yapmak yerine, **her tabloyu ayrÄ± sorguda** getirir.

ğŸ“œ **Ãœretilen SQL:**

```sql
-- 1. sorgu: Oteller
SELECT h.Id, h.Name, h.City, h.Star
FROM Hotels AS h;

-- 2. sorgu: Odalar
SELECT r.Id, r.Number, r.PricePerNight, r.HotelId
FROM Rooms AS r;

```

ğŸ§  EF Core iki sorgunun sonuÃ§larÄ±nÄ± **RAMâ€™de iliÅŸkilendirir**

(`Hotel.Id` â†” `Room.HotelId` eÅŸleÅŸmesine gÃ¶re).

ğŸ“Š **Bellekteki birleÅŸmiÅŸ sonuÃ§:**

```csharp
[
  {
    Id = 1,
    Name = "Hilton",
    Rooms = [
      { Id = 1, Number = "101" },
      { Id = 2, Number = "102" }
    ]
  },
  {
    Id = 2,
    Name = "Sheraton",
    Rooms = [
      { Id = 3, Number = "201" },
      { Id = 4, Number = "202" }
    ]
  }
]

```

GÃ¶rÃ¼yor musun?

ArtÄ±k SQL tarafÄ±nda otel bilgileri **tekrarlanmÄ±yor** â€” EF Core iki ayrÄ± listeyi birleÅŸtiriyor.

---

## ğŸ§  3. FarkÄ± Ã¶zetleyelim

|Ã–zellik|`.Include()` (Default)|`.Include().AsSplitQuery()`|
|---|---|---|
|Sorgu sayÄ±sÄ±|1 (JOINâ€™li)|2+ (her tablo ayrÄ±)|
|Tekrarlanan veri|Var (her iliÅŸki satÄ±rda tekrar)|Yok (veriler ayrÄ± Ã§ekilir)|
|Bellek kullanÄ±mÄ±|Daha fazla|Daha az|
|HÄ±z|KÃ¼Ã§Ã¼k veride daha hÄ±zlÄ±|BÃ¼yÃ¼k veride daha verimli|
|SQL okunabilirliÄŸi|Uzun JOIN|Daha basit sorgular|
|KullanÄ±m amacÄ±|Basit iliÅŸkiler|KarmaÅŸÄ±k veya Ã§ok `Include`â€™lu iliÅŸkiler|

---

## ğŸ’¡ 4. Ã–rnek: BÃ¼yÃ¼k veri farkÄ±

Diyelim ki:

- 1 otelde 1000 oda var.

### ğŸ§¾ **Single Query (JOIN)**

EF Core SQLâ€™de 1000 satÄ±r dÃ¶ndÃ¼rÃ¼r, her satÄ±rda otel bilgisi tekrar eder.

### âš™ï¸ **Split Query**

- 1 sorgu oteli getirir (1 satÄ±r)
    
- 1 sorgu odalarÄ± getirir (1000 satÄ±r)
    
    EF Core RAMâ€™de eÅŸleÅŸtirir â†’ 1001 satÄ±r yerine 2 kÃ¼Ã§Ã¼k sorgu.
    

SonuÃ§:

ğŸ‘‰ HafÄ±za daha az kullanÄ±lÄ±r

ğŸ‘‰ Daha stabil ve Ã¶lÃ§eklenebilir sorgu Ã§alÄ±ÅŸÄ±r

---

## ğŸ¯ Ã–zet tanÄ±m:

> .AsSplitQuery() = EF Coreâ€™a â€œJOIN yapma, iliÅŸkili tablolarÄ± ayrÄ± sorgularla getir, ben birleÅŸtiririmâ€ demektir.

KÄ±saca:

- KÃ¼Ã§Ã¼k veri â†’ fark az
- BÃ¼yÃ¼k ve iliÅŸkili veri â†’ **AsSplitQuery bÃ¼yÃ¼k fark yaratÄ±r**